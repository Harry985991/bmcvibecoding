<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIAR OKR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- REMOVED PapaParse external script -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Inter:wght@500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #F8F8F8;           /* page background - æ·ºç°è‰²èƒŒæ™¯ */
            --primary: #333333;      /* æ·±ç°è‰²æ–‡å­— */
            --banner: #1E1E3F;       /* banner color */
            --underline: #3B82F6;   /* banner åº•éƒ¨äº®è—ä¸‹åŠƒç·š */
            --muted: #666666;        /* æ¬¡è¦æ–‡å­—é¡è‰² */
            --accent: #007BFF;       /* ä¸»è¦è—è‰² */
            --teal: #E5E5E5;         /* æ·ºç°è‰² */
            --title-blue: #E3F2FD;   /* æ·ºè—è‰²æ¨™é¡ŒèƒŒæ™¯ */
            --card-bg: #ffffff;      /* ç™½è‰²å¡ç‰‡èƒŒæ™¯ */
            --section-bg: #ffffff;   /* ç™½è‰²å€å¡ŠèƒŒæ™¯ */
            --card-border: rgba(0,0,0,0.08);
            --success: #28A745;      /* æˆåŠŸç¶ è‰² */
            --warning: #FFC107;      /* è­¦å‘Šæ©™è‰² */
        }

        html { scroll-behavior: smooth; }
        body { 
            font-family: 'Inter','Noto Sans TC', 'Segoe UI', sans-serif; 
            background-color: var(--bg); 
            color: var(--primary); 
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        h1, h2, h3 { font-family: 'Inter','Noto Sans TC',sans-serif; }
        
        .card { 
            background-color: var(--card-bg); 
            border: 1px solid var(--card-border); 
            border-radius: 12px; 
            padding: 20px; 
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06); 
            display: flex; 
            flex-direction: column; 
            height: 100%; 
        }
        
        .bar-bg { background-color: var(--teal); }
        .bar-fill { transition: width 0.5s ease-in-out; }
        
        .category-title { 
            font-size: 18px; 
            font-weight: 700; 
            margin-bottom: 1.5rem; 
            display: flex; 
            align-items: center; 
            color: var(--primary); 
        }
        
        .kr-item { 
            margin-bottom: 2rem; 
            padding: 0.5rem; 
            margin: -0.5rem; 
            border-radius: 0.5rem; 
        }
        .kr-item:last-child { margin-bottom: 0; }
        
        .kr-title { 
            font-size: 16px; 
            font-weight: 600; 
            color: var(--primary); 
        }
        
        .upload-label { 
            cursor: pointer; 
            padding: 10px 16px; 
            background-color: var(--accent); 
            color: white; 
            border-radius: 8px; 
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s ease;
            border: none;
        }
        .upload-label:hover { 
            background-color: #0056b3; 
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.2);
        }
        
        details > summary { 
            cursor: pointer; 
            font-weight: 600; 
            color: var(--accent); 
            font-size: 14px;
        }
        
        /* Header styling */
        .header-banner {
            background: var(--banner);
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            position: relative;
        }
        
        .header-banner::after {
            content: "";
            position: absolute;
            left: 0;
            right: 0;
            bottom: 0;
            height: 4px;
            background: var(--underline);
            border-bottom-left-radius: 12px;
            border-bottom-right-radius: 12px;
        }
        
        .header-title {
            font-size: 24px;
            font-weight: 700;
            color: #ffffff;
        }
        
        .header-year {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
        }
        
        /* Objective card styling */
        .objective-card {
            background: linear-gradient(135deg, #f45d48 0%, #e63946 100%);
            color: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(244, 93, 72, 0.2);
            margin-bottom: 24px;
        }
        
        .objective-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 12px;
        }
        
        .objective-text {
            font-size: 16px;
            opacity: 0.95;
            line-height: 1.6;
        }
        
        /* Progress section */
        .progress-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 12px;
        }
        
        .progress-percentage {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }
        
        .progress-bar {
            height: 32px;
            background-color: var(--teal);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #f45d48 0%, #e63946 100%);
            height: 100%;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 16px;
            transition: width 0.5s ease-in-out;
        }
        
        /* KR styling */
        .kr-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--accent);
        }
        
        .kr-target {
            font-size: 16px;
            color: var(--muted);
            margin-left: 8px;
        }
        
        .kr-progress-bar {
            height: 12px;
            background-color: var(--teal);
            border-radius: 6px;
            overflow: hidden;
            margin-top: 12px;
        }
        
        .kr-progress-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 0.5s ease-in-out;
        }
        
        /* Color variations for different categories */
        .color-teal { color: #078080; }
        .color-coral { color: #f45d48; }
        .color-dark { color: #232323; }
        
        .bg-teal { background-color: #078080; }
        .bg-coral { background-color: #f45d48; }
        .bg-dark { background-color: #232323; }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .header-title { font-size: 20px; }
            .header-year { font-size: 16px; }
            .objective-title { font-size: 18px; }
            .objective-text { font-size: 14px; }
            .progress-title { font-size: 16px; }
            .progress-percentage { font-size: 20px; }
            .kr-value { font-size: 28px; }
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8">

    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="header-banner flex justify-between items-center mb-8 gap-4">
            <h1 class="header-title">AIAR OKR Dashboard</h1>
            <p class="header-year">2025</p>
        </header>

        <!-- Main Content Layout -->
        <div class="space-y-6">
            <div id="dashboard-content" class="space-y-6">
                <!-- Objective & Progress Card -->
                <div class="card">
                    <div class="objective-card">
                        <h2 class="objective-title">æˆ‘å€‘çš„ç›®æ¨™ (Objective)</h2>
                        <p class="objective-text">åœ¨çµ„ç¹”å…§ç‡Ÿé€ ç©æ¥µæ“æŠ± AI çš„å·¥ä½œæ°›åœï¼Œæ¨å»£å¤–éƒ¨ AI å·¥å…·æ–¼å…¨å…¬å¸åŒä»çš„æ—¥å¸¸å·¥ä½œæµç¨‹ä¸­ï¼Œä½¿å…¶æˆç‚ºæå‡æ•ˆç‡èˆ‡å“è³ªçš„é—œéµé©…å‹•åŠ›ã€‚</p>
                    </div>
                    <div>
                        <div class="flex justify-between items-center mb-3">
                            <h2 class="progress-title">ç¸½é«”é€²åº¦ (Actual Progress)</h2>
                            <span id="overallProgressText" class="progress-percentage">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div id="overallProgressBar" class="progress-fill bar-fill" style="width: 0%;"></div>
                        </div>
                    </div>
                </div>

                <!-- Categories Grid -->
                <div id="category-grid-container" class="grid grid-cols-1 lg:grid-cols-3 gap-6"></div>

            </div>
            
            <!-- Uploader Card -->
            <div id="uploader-card" class="card items-center">
                 <h2 class="text-xl font-bold text-[#232323] mb-4">æ›´æ–°å„€è¡¨æ¿è³‡æ–™</h2>
                 <p class="text-gray-500 mb-6">è«‹åŒ¯å…¥ä¸€å€‹ CSV æª”æ¡ˆä¾†æ›´æ–°æ‰€æœ‰å„€è¡¨æ¿æ•¸æ“šèˆ‡ç›®æ¨™ã€‚</p>
                 <label for="csvFileInput" class="upload-label">ğŸ“ åŒ¯å…¥ CSV æª”æ¡ˆ</label>
                 <input type="file" id="csvFileInput" class="hidden" accept=".csv, text/csv">
                 <p id="fileName" class="text-gray-500 mt-4 text-sm"></p>
                 <details class="mt-4 text-left text-sm text-gray-600 bg-gray-100 p-4 rounded-lg w-full">
                    <summary>æŸ¥çœ‹ CSV æ ¼å¼èªªæ˜</summary>
                    <div class="mt-2 space-y-2">
                        <p>CSV æª”æ¡ˆåªéœ€è¦åŒ…å« `type` ç‚º `kr` çš„è³‡æ–™åˆ—å³å¯ã€‚</p>
                        <ul class="list-disc list-inside space-y-2">
                            <li>
                                <strong>æŒ‡æ¨™å®šç¾© (type = kr):</strong>
                                <ul class="list-['-_'] list-inside ml-4">
                                    <li>`value1`: KR çš„ **ç›®æ¨™å€¼** (e.g., 5000)</li>
                                    <li>`value2`: KR çš„ **ç›®å‰çµæœ** (e.g., 4321)</li>
                                    <li>`note`: `åˆ†é¡åç¨±;åœ–ç¤º;é¡è‰²`</li>
                                </ul>
                            </li>
                        </ul>
                        <p class="font-semibold mt-4">ç¯„ä¾‹:</p>
                        <pre class="bg-white p-2 rounded text-xs"><code>type,name,value1,value2,note
kr,"KR 1ï¼šæ–‡ç« é–±è®€äººæ¬¡",5000,3932,"æå‡ AI èªçŸ¥;ğŸ§ ;teal"
...</code></pre>
                    </div>
                 </details>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            // --- CUSTOM CSV PARSER (No external dependencies) ---
            function customCsvParser(csvText) {
                const lines = csvText.trim().split(/\r?\n/);
                const dataLines = lines.filter(line => line.trim() && !line.trim().startsWith('#'));
                if (dataLines.length < 2) return { data: [], errors: [{ message: "CSV is empty or has only a header." }] };

                const headers = dataLines.shift().split(',').map(h => h.trim());
                
                const data = dataLines.map(line => {
                    const values = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    const obj = {};
                    headers.forEach((header, i) => {
                        let value = (values[i] || '').trim();
                        if (value.startsWith('"') && value.endsWith('"')) {
                            value = value.slice(1, -1).replace(/""/g, '"');
                        }
                        obj[header] = value;
                    });
                    return obj;
                });
                
                return { data: data, errors: [] };
            }

            const defaultRawData = [
                // KR Definitions - All results are now defaulted to 0
                { type: 'kr', name: 'KR 1ï¼šæ–‡ç« é–±è®€äººæ¬¡', value1: 5000, value2: 0, note: 'æå‡ AI èªçŸ¥;ğŸ§ ;teal' },
                { type: 'kr', name: 'KR 2ï¼šå½±ç‰‡è§€çœ‹äººæ¬¡', value1: 1000, value2: 0, note: 'æå‡ AI èªçŸ¥;ğŸ§ ;teal' },
                { type: 'kr', name: 'KR 3ï¼šç¤¾ç¾¤æˆå“¡äººæ•¸', value1: 150, value2: 0, note: 'æ“´å¤§ç¤¾ç¾¤å½±éŸ¿;ğŸš€;coral' },
                { type: 'kr', name: 'KR 4ï¼šç¤¾ç¾¤äº’å‹•æ¬¡æ•¸', value1: 500, value2: 0, note: 'æ“´å¤§ç¤¾ç¾¤å½±éŸ¿;ğŸš€;coral' },
                { type: 'kr', name: 'KR 5ï¼šèª²ç¨‹åƒèˆ‡äººæ¬¡', value1: 100, value2: 0, note: 'æ·±åŒ–æ‡‰ç”¨èƒ½åŠ›;ğŸ› ï¸;dark' },
                { type: 'kr', name: 'KR 6ï¼šé€šéAIèªè­‰L2äººæ•¸', value1: 10, value2: 0, note: 'æ·±åŒ–æ‡‰ç”¨èƒ½åŠ›;ï¿½ï¸;dark' },
            ];

            const fileInput = document.getElementById('csvFileInput');
            const fileNameEl = document.getElementById('fileName');
            
            processAndRenderDashboard(defaultRawData);
            fileInput.addEventListener('change', handleFileSelect);

            function handleFileSelect(event) {
                const file = event.target.files[0];
                if (!file) return;
                fileNameEl.textContent = `è™•ç†ä¸­ï¼š${file.name}`;

                const reader = new FileReader();
                reader.onload = function(e) {
                    const csvText = e.target.result;
                    const results = customCsvParser(csvText);

                    if (results.errors.length > 0) {
                        fileNameEl.textContent = `éŒ¯èª¤ï¼šç„¡æ³•è§£ææ­¤ CSV æª”æ¡ˆã€‚`;
                        return;
                    }
                    
                    if (!results.data.some(row => (row.type || '').toLowerCase() === 'kr')) {
                        fileNameEl.textContent = `éŒ¯èª¤ï¼šCSV ç¼ºå°‘æŒ‡æ¨™å®šç¾© (type='kr') çš„è³‡æ–™åˆ—ã€‚`;
                        return;
                    }

                    fileNameEl.textContent = `æˆåŠŸæ›´æ–°è³‡æ–™ä¾†æºï¼š${file.name}`;
                    processAndRenderDashboard(results.data);
                };
                reader.onerror = function() {
                    fileNameEl.textContent = "éŒ¯èª¤ï¼šè®€å–æª”æ¡ˆå¤±æ•—ã€‚";
                };
                reader.readAsText(file, 'UTF-8');
            }
            
            function processAndRenderDashboard(rawData) {
                try {
                    const krDefs = rawData.filter(r => (r.type || '').toLowerCase() === 'kr');

                    const okrData = {};
                    krDefs.forEach(kr => {
                        const [categoryName, icon, color] = (kr.note || 'æœªåˆ†é¡;;').split(';');
                        if (!okrData[categoryName]) {
                            okrData[categoryName] = { icon, color, results: [] };
                        }
                        okrData[categoryName].results.push({
                            name: kr.name,
                            target: parseInt(kr.value1, 10) || 0,
                            result: parseInt(kr.value2, 10) || 0,
                        });
                    });
                    
                    renderDashboard(okrData);
                } catch (e) {
                    console.error("è™•ç†æˆ–æ¸²æŸ“è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤:", e);
                    fileNameEl.textContent = "è™•ç†è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ä¸»æ§å°ã€‚";
                }
            }

            function renderDashboard(okrData) {
                const categoryContainer = document.getElementById('category-grid-container');
                categoryContainer.innerHTML = '';

                // Hide the details container if it exists, as it's no longer used
                const detailsContainer = document.getElementById('details-container');
                if(detailsContainer) {
                    detailsContainer.style.display = 'none';
                }


                const colorMap = {
                    teal: { text: 'color-teal', bg: 'bg-teal' },
                    coral: { text: 'color-coral', bg: 'bg-coral' },
                    dark: { text: 'color-dark', bg: 'bg-dark' },
                };

                let totalResult = 0, totalTarget = 0;
                Object.values(okrData).forEach(cat => cat.results.forEach(kr => {
                    totalResult += kr.result;
                    totalTarget += kr.target;
                }));
                const overallPercentage = totalTarget > 0 ? (totalResult / totalTarget) * 100 : 0;
                const progressBar = document.getElementById('overallProgressBar');
                const progressText = document.getElementById('overallProgressText');
                const percentage = overallPercentage.toFixed(0);
                progressBar.style.width = `${Math.min(100, overallPercentage)}%`; 
                progressText.textContent = `${percentage}%`;
                progressBar.textContent = overallPercentage > 15 ? `${percentage}%` : '';

                Object.keys(okrData).forEach(categoryName => {
                    const category = okrData[categoryName];
                    const colors = colorMap[category.color] || colorMap.dark;
                    const keyResultsHtml = category.results.map(kr => {
                        const percentage = kr.target > 0 ? (kr.result / kr.target) * 100 : 0;
                        return `
                            <div class="kr-item">
                                <p class="kr-title mb-2">${kr.name}</p>
                                <div class="flex justify-between items-baseline">
                                    <div>
                                        <span class="kr-value ${colors.text}">${kr.result.toLocaleString()}</span>
                                        <span class="kr-target">/ ${kr.target.toLocaleString()}</span>
                                    </div>
                                </div>
                                <div class="kr-progress-bar">
                                    <div class="kr-progress-fill ${colors.bg} bar-fill" style="width: ${Math.min(100, percentage)}%"></div>
                                </div>
                            </div>`;
                    }).join('');
                    categoryContainer.innerHTML += `
                        <div class="card">
                            <h2 class="category-title"><span class="mr-3 text-3xl">${category.icon}</span>${categoryName}</h2>
                            <div class="mt-auto">${keyResultsHtml}</div>
                        </div>`;
                });
            }
        });
    </script>

</body>
</html>
ï¿½
